var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{r as s}from"./phaser-UvlxNa5i.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var i=s();class r extends i.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}class n extends i.Scene{constructor(){super("Preloader")}init(){this.add.image(512,384,"background"),this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const e=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(t=>{e.width=4+460*t}))}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png")}create(){this.scene.start("MatchScene",{playerCount:2,mapName:"canyon"})}}class o extends i.Scene{constructor(){super("MainMenu"),t(this,"background"),t(this,"logo"),t(this,"title")}create(){this.background=this.add.image(512,384,"background"),this.logo=this.add.image(512,300,"logo"),this.title=this.add.text(512,460,"Main Menu",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("MatchScene",{playerCount:2,mapName:"canyon"})}))}}class a{constructor({scene:e}){if(t(this,"scene"),!e)throw new Error("scene parameter is missing or invalid");this.scene=e}createPhaserListeners({entities:e}){const t=this.scene.input.keyboard;t&&e instanceof Map&&e.size&&e.forEach((({keymap:e})=>{e&&Object.keys(e.codes).forEach((s=>{const i=e.codes[s];e.listeners[s]=t.addKey(i)}))}))}}class c{constructor({scene:e}){if(t(this,"scene"),!e)throw new Error("scene parameter is missing or invalid");this.scene=e}update({entities:e}){if(!(e instanceof Map))throw new Error("Entities is not a Map: "+typeof e);e.forEach((({keymap:e,input:t})=>{if(e&&t)for(const[s,i]of Object.entries(e.listeners))i&&(t[s]=i.isDown)}))}}class d{constructor({scene:e}){t(this,"scene"),this.scene=e}update({entities:e}){e.forEach((({input:e,movement:t,sprite:s})=>{if(!e||!t||!(null==s?void 0:s.body))return;const i=e.left||e.right,r=e.jump;let n=0,o=s.body.velocity.y;i&&(e.left&&(console.log("left:",e.left),n=-t.ground.speed,s.setFlipX(!0)),e.right&&(console.log("right:",e.right),n=t.ground.speed,s.setFlipX(!1))),r&&(console.log("jump:",r),o=-t.air.speed),this.scene.matter.body.setVelocity(s.body,{x:n,y:o})}))}}const l=["left","right","up","down","jump","dash","sword","gun"],h={AIR:{FRICTION:.05,SPEED:5},GROUND:{FRICTION:.21,SPEED:5}},p=({player:e})=>({codes:{up:"W",down:"S",left:"A",right:"D",jump:"K",dash:"L",sword:"J",gun:"I"},listeners:l.reduce(((e,t)=>(e[t]=null,e)),{})});function u({entityType:e}){const t={player:h};return{air:{speed:t[e].AIR.SPEED,friction:t[e].AIR.FRICTION},ground:{speed:t[e].GROUND.SPEED,friction:t[e].GROUND.FRICTION}}}class m extends Phaser.Scene{constructor(){super("MatchScene"),t(this,"matchConfig"),t(this,"entities",new Map),t(this,"keymapSystem"),t(this,"inputSystem"),t(this,"movementSystem")}init(e){this.matchConfig=e}preload(){this.loadPlayerAssets()}loadPlayerAssets(){this.loadFirstPlayerAssets()}loadFirstPlayerAssets(){this.load.image({key:"otomo_idle",url:"/assets/sprites/characters/otomo/v1/spr_idle.png"})}create(){this.createECS(),this.createKeyboardInputs()}createECS(){this.createEntities(),this.createSystems()}createEntities(){this.createPlayer({x:100,y:100})}createPlayer({x:e,y:t}){const s=this.matter.add.sprite(e,t,"otomo_idle",void 0);s.setFixedRotation(),s.setFriction(0);const i={entityId:"player_01",keymap:p({player:"01"}),input:l.reduce(((e,t)=>(e[t]=!1,e)),{}),movement:u({entityType:"player"}),sprite:s};this.entities.set(i.entityId,i)}createSystems(){this.keymapSystem=new a({scene:this}),this.inputSystem=new c({scene:this}),this.movementSystem=new d({scene:this})}createKeyboardInputs(){this.keymapSystem.createPhaserListeners({entities:this.entities})}update(){this.inputSystem.update({entities:this.entities}),this.movementSystem.update({entities:this.entities})}}const y={type:i.AUTO,width:352,height:240,parent:"game-container",backgroundColor:"#000000ff",physics:{default:"matter",matter:{gravity:{x:0,y:1.5},debug:!0,setBounds:{x:0,y:0,width:352,height:240,left:!0,right:!0,top:!0,bottom:!0}}},scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},render:{pixelArt:!0,antialias:!1},input:{keyboard:!0},scene:[r,n,o,m]};document.addEventListener("DOMContentLoaded",(()=>{new i.Game({...y,parent:"game-container"})}));
