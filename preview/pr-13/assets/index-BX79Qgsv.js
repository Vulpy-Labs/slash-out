var t=Object.defineProperty,e=(e,a,s)=>((e,a,s)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s)(e,"symbol"!=typeof a?a+"":a,s);import{r as a}from"./phaser-UvlxNa5i.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const a of t)if("childList"===a.type)for(const t of a.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var s=a();class r extends s.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}class i extends s.Scene{constructor(){super("Preloader")}init(){this.add.image(512,384,"background"),this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const t=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(e=>{t.width=4+460*e}))}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png")}create(){this.scene.start("TestScene")}}const o=[];for(let p=0;p<256;++p)o.push((p+256).toString(16).slice(1));let h;const n=new Uint8Array(16),c={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};class l extends Phaser.Scene{constructor(){super("TestScene"),e(this,"gameWidth",352),e(this,"gameHeight",240),e(this,"mapImages"),e(this,"platforms"),e(this,"map"),e(this,"character"),e(this,"cursors"),e(this,"playerState","IDLE"),e(this,"isPlayerMovingHorizontally"),e(this,"isPlayerTouchingGround"),e(this,"keyboardInputs"),e(this,"weaponState"),e(this,"sword"),e(this,"bullets",[]),e(this,"bulletsLeft",3)}preload(){this.loadAssets()}loadAssets(){this.loadMapAssets(),this.loadCharacterMovementAssets(),this.loadCharacterAttackAssets(),this.loadWeaponsAssets()}loadMapAssets(){this.load.image("platform","https://labs.phaser.io/assets/sprites/platform.png"),this.load.tilemapTiledJSON("canyon_map","assets/maps/canyon.json"),this.loadMapImages()}loadCharacterMovementAssets(){this.load.spritesheet("spr_idle","assets/characters/otomo/v1/spr_idle.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("spr_running","assets/characters/otomo/v1/spr_running.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("spr_jump","assets/characters/otomo/v1/spr_jump.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("spr_look_up","assets/characters/otomo/v1/spr_lookup.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("spr_look_down","assets/characters/otomo/v1/spr_lookdown.png",{frameWidth:16,frameHeight:16})}loadCharacterAttackAssets(){this.load.spritesheet("spr_attack_sword","assets/characters/otomo/v1/spr_shortattack.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("spr_attack_sword_up","assets/characters/otomo/v1/spr_shortattackup.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("spr_attack_sword_down","assets/characters/otomo/v1/spr_shortattackdown.png",{frameWidth:16,frameHeight:16})}loadWeaponsAssets(){for(let t=0;t<5;t++)this.load.image(`spr_sword_${t}`,`assets/sprites/combat/melee/spr_sword/spr_sword_${t}.png`);this.load.spritesheet("spr_sword_idle","assets/sprites/combat/melee/spr_sword/spr_sword_0.png",{frameWidth:16,frameHeight:16});for(let t=0;t<2;t++)this.load.image(`spr_bullet_${t}`,`assets/sprites/combat/range/spr_bullet/spr_bullet_${t}.png`);for(let t=0;t<16;t++)this.load.image(`spr_blast_${t}`,`assets/sprites/combat/range/spr_blast/spr_blast_${t}.png`)}create(){this.createMap(),this.createTitle(),this.createCharacter(),this.createKeyboardInputs(),this.createWeapons()}update(){this.updateCharacterMovement(),this.updateWeaponsAttachmentToCharacter(),this.updateCharacterAttack()}loadMapImages(){this.mapImages=["bg_FG_0","at_bgrock_0","bg_rock_0","bg_bamboo_0","spr_bamboo_1","spr_grass_group_1","spr_grass_group_2","bg_forestrock_0"],this.mapImages.forEach((t=>{this.load.image(t,`assets/sprites/maps/${t}.png`)}))}createTitle(){this.add.text(16,16,"Slash Out Level Test",{fontStyle:"bold",fontSize:"14px",color:"#fff"})}createMap(){this.map=this.make.tilemap({key:"canyon_map"});const t=[];this.mapImages.forEach((e=>{const a=this.map.addTilesetImage(e,e);a&&t.push(a)})),this.createMapLayer("background",t);const e=this.createMapLayer("ground",t);this.platforms=e.find((t=>null==t?void 0:t.layer.name.includes("platform"))),this.platforms.setCollisionByProperty({collider:!0}),this.createMapLayer("foreground",t)}createMapLayer(t,e){return this.map.layers.filter((e=>e.name.startsWith(`${t}/`))).map((t=>this.map.createLayer(t.name,e,0,0)))}createCharacter(){this.character=this.physics.add.sprite(150,100,"spr_idle"),this.createCharacterCollisions(),this.createCharacterAnimations()}createCharacterCollisions(){this.character.setCollideWorldBounds(!0),this.physics.add.collider(this.character,this.platforms)}createCharacterAnimations(){this.createCharacterMovementAnimations(),this.createCharacterAttackAnimations()}createCharacterMovementAnimations(){this.anims.create({key:"anim_idle",frames:this.anims.generateFrameNumbers("spr_idle",{start:0,end:0}),frameRate:7,repeat:-1}),this.anims.create({key:"anim_running",frames:this.anims.generateFrameNumbers("spr_running",{start:0,end:1}),frameRate:6,repeat:-1}),this.anims.create({key:"anim_look_up",frames:this.anims.generateFrameNumbers("spr_look_up",{start:0,end:0}),frameRate:7,repeat:-1}),this.anims.create({key:"anim_look_down",frames:this.anims.generateFrameNumbers("spr_look_down",{start:0,end:0}),frameRate:7,repeat:-1}),this.anims.create({key:"anim_jump",frames:this.anims.generateFrameNumbers("spr_jump",{start:1,end:2}),frameRate:12}),this.anims.create({key:"anim_in_air",frames:this.anims.generateFrameNumbers("spr_jump",{start:2,end:2}),frameRate:12})}createCharacterAttackAnimations(){this.anims.create({key:"anim_attack_sword",frames:this.anims.generateFrameNumbers("spr_attack_sword",{start:0,end:0}),frameRate:7,repeat:-1}),this.anims.create({key:"anim_attack_sword_up",frames:this.anims.generateFrameNumbers("spr_attack_sword_up",{start:0,end:0}),frameRate:7,repeat:-1}),this.anims.create({key:"anim_attack_sword_down",frames:this.anims.generateFrameNumbers("spr_attack_sword_down",{start:0,end:0}),frameRate:7,repeat:-1})}createWeaponsAnimations(){this.anims.create({key:"anims_attack_sword_trail",frames:[{key:"spr_sword_0"},{key:"spr_sword_1"},{key:"spr_sword_2"},{key:"spr_sword_3"},{key:"spr_sword_4"}],frameRate:24,repeat:-1}),this.anims.create({key:"anims_attack_bullet",frames:[{key:"spr_bullet_0"},{key:"spr_bullet_1"}],frameRate:12,repeat:-1}),this.anims.create({key:"anims_attack_bullet_destroy",frames:new Array(15).fill("").map(((t,e)=>({key:`spr_blast_${e}`}))),frameRate:30,repeat:0})}setPlayerState(t){if(this.playerState!==t)switch(this.playerState=t,t){case"IDLE":this.character.anims.play("anim_idle",!0);break;case"RUNNING":this.character.anims.play("anim_running",!0);break;case"JUMPING":this.character.anims.play("anim_jump",!0);break;case"IN_AIR":this.character.anims.play("anim_in_air",!0);break;case"LOOKING_UP":this.character.anims.play("anim_look_up",!0);break;case"LOOKING_DOWN":this.character.anims.play("anim_look_down",!0);break;case"ATTACKING_FORWARD":this.character.anims.play("anim_attack_sword",!0);break;case"ATTACKING_UP":this.character.anims.play("anim_attack_sword_up",!0);break;case"ATTACKING_DOWN":this.character.anims.play("anim_attack_sword_down",!0)}}validateBulletId({objId:t}){try{if(t){if(!this.bullets.find((({bulletId:e})=>e===t)))throw new Error(`Bullet not found for id: ${t}`);return!0}}catch(e){throw Error(e)}}setWeaponState({newState:t,objId:e}){switch(this.weaponState=t,t){case"SWORD_FORWARD":case"SWORD_UP":case"SWORD_DOWN":this.sword.anims.play("anims_attack_sword_trail",!0);break;case"BULLET_DESTROYED":case"SHOOTING_FORWARD":case"SHOOTING_UP":case"SHOOTING_DOWN":this.validateBulletId({objId:e})&&this.bullets.find((({bulletId:t})=>t===e)).anims.play("BULLET_DESTROYED"===t?"anims_attack_bullet_destroy":"anims_attack_bullet",!0)}}createKeyboardInputs(){const t=this.input.keyboard;this.cursors=this.input.keyboard.createCursorKeys(),this.keyboardInputs={left:t.addKey("A"),right:t.addKey("D"),up:t.addKey("W"),down:t.addKey("S"),jump:t.addKey("SPACE"),attack:t.addKey("F"),shoot:t.addKey("G"),dash:t.addKey("SHIFT")}}createWeapons(){this.sword=this.physics.add.sprite(this.character.x,this.character.y,"spr_sword_0"),this.createWeaponsAnimations(),this.createWeaponCollisions()}createWeaponCollisions(){this.createSwordCollision()}createSwordCollision(){this.sword.setCollideWorldBounds(!0),this.sword.body.allowGravity=!1,this.physics.add.overlap(this.sword,this.character),this.physics.add.overlap(this.sword,this.platforms)}createBullet(){const t=function(t){var e;if(c.randomUUID&&!t)return c.randomUUID();const a=(t=t||{}).random??(null==(e=t.rng)?void 0:e.call(t))??function(){if(!h){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");h=crypto.getRandomValues.bind(crypto)}return h(n)}();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=15&a[6]|64,a[8]=63&a[8]|128,function(t,e=0){return(o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]).toLowerCase()}(a)}(),e=this.physics.add.sprite(this.character.x,this.character.y,"spr_bullet_0");return e.bulletId=t,e.isBeingDestroyed=!1,this.bullets.push(e),this.createBulletCollision({bullet:e}),this.updateBulletAttachmentToCharacter({bullet:e}),t}createBulletCollision({bullet:t}){t.setCollideWorldBounds(!1),t.body.allowGravity=!1,this.physics.add.collider(t,this.character,(()=>{this.destroyBullet({id:t.bulletId})})),this.physics.add.collider(t,this.platforms,(()=>{this.destroyBullet({id:t.bulletId})}))}updateCharacterMovement(){this.character&&this.cursors&&(this.isPlayerMovingHorizontally=this.cursors.left.isDown||this.keyboardInputs.left.isDown||this.cursors.right.isDown||this.keyboardInputs.right.isDown,this.isPlayerTouchingGround=this.character.body.blocked.down,this.updateHorizontalMovement(),this.updateVerticalMovement())}updateHorizontalMovement(){this.cursors.left.isDown||this.keyboardInputs.left.isDown?(this.character.setVelocityX(-100),this.character.setFlipX(!0),this.isPlayerTouchingGround&&this.setPlayerState("RUNNING")):this.cursors.right.isDown||this.keyboardInputs.right.isDown?(this.character.setVelocityX(100),this.character.setFlipX(!1),this.isPlayerTouchingGround&&this.setPlayerState("RUNNING")):this.isPlayerTouchingGround&&!this.isPlayerMovingHorizontally&&(this.character.setVelocityX(0),this.setPlayerState("IDLE"))}updateVerticalMovement(){Phaser.Input.Keyboard.JustDown(this.keyboardInputs.jump)&&this.isPlayerTouchingGround&&(this.character.setVelocityY(-450),this.setPlayerState("JUMPING")),this.isPlayerTouchingGround||this.setPlayerState("IN_AIR"),(this.cursors.up.isDown||this.keyboardInputs.up.isDown)&&!this.isPlayerMovingHorizontally&&this.isPlayerTouchingGround?this.setPlayerState("LOOKING_UP"):(this.cursors.down.isDown||this.keyboardInputs.down.isDown)&&!this.isPlayerMovingHorizontally&&this.isPlayerTouchingGround&&this.setPlayerState("LOOKING_DOWN")}updateWeaponsAttachmentToCharacter(){this.updateSwordAttachmentToCharacter()}updateSwordAttachmentToCharacter(){let t=this.character.x,e=this.character.y,a=0,s=48,r=24;"LOOKING_UP"===this.playerState?(a=-90,s=24,r=48,t=this.character.x,e=this.character.y-this.character.height/2-r/2):"LOOKING_DOWN"===this.playerState?(a=90,s=24,r=48,t=this.character.x,e=this.character.y+this.character.height/2+r/2):(this.character.flipX?(a=180,t=this.character.x-this.character.width/2-s/2):(a=0,t=this.character.x+this.character.width/2+s/2),e=this.character.y),this.sword.setOrigin(.5,.5),this.sword.setAngle(a),this.sword.body.setSize(s,r),this.sword.setPosition(t,e)}updateBulletAttachmentToCharacter({bullet:t}){if(!t)throw new Error("Not possible to attach bullet to the character. Bullet is undefined");let e=this.character.x,a=this.character.y,s=0,r=16,i=16;"LOOKING_UP"===this.playerState?(s=-90,r=16,i=16,e=this.character.x,a=this.character.y-this.character.height/2-i/2):"LOOKING_DOWN"===this.playerState?(s=90,r=16,i=16,e=this.character.x,a=this.character.y+this.character.height/2+i/2):(this.character.flipX?(s=180,e=this.character.x-this.character.width/2-r/2):(s=0,e=this.character.x+this.character.width/2+r/2),a=this.character.y),t.setOrigin(.5,.5),t.setAngle(s),t.body.setSize(r,i),t.setPosition(e,a)}updateCharacterAttack(){this.updateSwordAttack(),this.updateBulletAttack()}updateSwordAttack(){this.keyboardInputs.attack.isDown?(this.sword.setVisible(!0),"LOOKING_UP"===this.playerState?(this.setPlayerState("ATTACKING_UP"),this.setWeaponState({newState:"SWORD_UP"})):"LOOKING_DOWN"===this.playerState?(this.setPlayerState("ATTACKING_DOWN"),this.setWeaponState({newState:"SWORD_DOWN"})):(this.setPlayerState("ATTACKING_FORWARD"),this.setWeaponState({newState:"SWORD_FORWARD"}))):this.sword&&this.sword.setVisible(!1)}updateBulletAttack(){if(Phaser.Input.Keyboard.JustDown(this.keyboardInputs.shoot)&&this.bulletsLeft){const t=this.createBullet();"LOOKING_UP"===this.playerState?(this.setPlayerState("ATTACKING_UP"),this.setWeaponState({newState:"SHOOTING_UP",objId:t})):"LOOKING_DOWN"===this.playerState?(this.setPlayerState("ATTACKING_DOWN"),this.setWeaponState({newState:"SHOOTING_DOWN",objId:t})):(this.setPlayerState("ATTACKING_FORWARD"),this.setWeaponState({newState:"SHOOTING_FORWARD",objId:t})),this.bulletsLeft--,this.updateBulletMovement({id:t})}}updateBulletMovement({id:t}){const e=this.bullets.find((({bulletId:e})=>e===t));if(!e)throw new Error(`Not possible to move projectile. Bullet not found for id: ${t}`);switch(this.weaponState){case"SHOOTING_FORWARD":this.character.flipX?e.setVelocityX(-210):e.setVelocityX(210);break;case"SHOOTING_UP":e.setVelocityY(-210);break;case"SHOOTING_DOWN":e.setVelocityY(210)}}destroyBullet({id:t}){const e=this.bullets.find((({bulletId:e})=>e===t));if(!e)throw new Error(`Not possible to destroy the bullet. It wasn't found for id: ${t}`);e.isBeingDestroyed||(e.isBeingDestroyed=!0,this.setWeaponState({newState:"BULLET_DESTROYED",objId:e.bulletId}),e.once("animationcomplete",(t=>{if("anims_attack_bullet_destroy"===t.key){const t=this.bullets.indexOf(e);if(-1===t)throw new Error(`Not possible to destroy the bullet. It wasn't found for index: ${t}`);this.bullets.splice(t,1),e.destroy()}})))}}const d={type:s.AUTO,width:352,height:240,parent:"game-container",backgroundColor:"#00000",physics:{default:"arcade",arcade:{gravity:{x:0,y:1300},debug:!0}},scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},render:{pixelArt:!0,antialias:!1},input:{keyboard:!0},scene:[r,i,l]};document.addEventListener("DOMContentLoaded",(()=>{new s.Game({...d,parent:"game-container"})}));
