#!/bin/bash

# ObtÃªm o nome da branch
full_branch_name=$(git rev-parse --abbrev-ref HEAD)

# ObtÃªm a parte do nome da branch que vem depois do primeiro "/"
branch_name=$(echo "$full_branch_name" | sed 's:.*/::')

# ObtÃªm a mensagem de commit que Ã© recebida atravÃ©s do argumento
commit_message=$(cat "$1")

# Ignora a formataÃ§Ã£o de commit nos casos de merge
case "$commit_message" in
  Merge*)
    exit 0
    ;;
esac

# Define tipos vÃ¡lidos de commit e seus emojis equivalentes
# Site com a lista de emojis: https://gitmoji.dev/
declare -A types_emojis=(
  [anim]="ðŸ’«"
  [asset]="ðŸ±"
  [build]="ðŸ—"
  [chore]="ðŸ§¹"
  [ci]="ðŸ‘·"
  [config]="ðŸ”§"
  [comment]="ðŸ’¡"
  [db]="ðŸ—ƒï¸"
  [del]="ðŸ”¥"
  [dep_new]="âž•"
  [dep_del]="âž–"
  [dep_down]="ðŸ“‰"
  [dep_up]="ðŸ“ˆ"
  [deploy]="ðŸš€"
  [dev]="ðŸ‘¨â€ðŸ’»"
  [doc]="ðŸ“"
  [feat]="âœ¨"
  [fix]="ðŸ›"
  [hotfix]="ðŸš‘ï¸"
  [intl]="ðŸŒ"
  [lint]="ðŸš¨"
  [log]="ðŸ”Š"
  [move]="ðŸšš"
  [perf]="âš¡ï¸"
  [refac]="â™»ï¸"
  [responsive]="ðŸ“±"
  [revert]="âª"
  [role]="ðŸ›‚"
  [snap]="ðŸ“¸"
  [style]="ðŸŽ¨"
  [tada]="ðŸŽ‰"
  [test]="ðŸ§ª"
  [type]="ðŸ·ï¸"
  [typo]="âœï¸"
  [wip]="ðŸš§"
)

# ObtÃªm o tipo de commit (deve aparecer antes do primeiro ':')
commit_type=$(echo "$commit_message" | cut -d':' -f1)

# Verifica se o tipo obtido Ã© vÃ¡lido
if [[ -n "${types_emojis[$commit_type]}" ]]; then
  emoji="${types_emojis[$commit_type]}"
else
  valid_types=$(printf "%s, " "${!types_emojis[@]}" | sed 's/, $//')
  echo "Invalid commit type '$commit_type'. Please use one of the following types: $valid_types"
  exit 1
fi

# retorna mensagem de commit formatada
new_message="$emoji | ${commit_type}($branch_name):${commit_message#*:}"
echo "$new_message" > "$1"
